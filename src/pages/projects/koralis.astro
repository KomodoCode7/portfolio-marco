---
import Layout from '../../layouts/Layout.astro';
import SectionContainer from '../../components/SectionContainer.astro';
import Nextjs from '../../components/icons/Nextjs.astro';
import Typescript from '../../components/icons/Typescript.astro';
import Prisma from '../../components/icons/Prisma.astro';
import Azure from '../../components/icons/Azure.astro';

const TECH_STACK = [
    { name: "Next.js", icon: Nextjs, color: "from-cyan-500 to-blue-500" },
    { name: "NestJS", icon: Typescript, color: "from-red-500 to-pink-500" },
    { name: "PostgreSQL/Neon", icon: Prisma, color: "from-purple-500 to-indigo-500" },
    { name: "Cloud Run", icon: Azure, color: "from-blue-500 to-cyan-500" },
    { name: "Cloudflare R2", icon: Azure, color: "from-orange-500 to-yellow-500" },
    { name: "MS Entra ID", icon: Azure, color: "from-green-500 to-emerald-500" }
]

const FEATURES = [
    {
        title: "Sistema de Cotizaciones",
        description: "GestiÃ³n completa del ciclo de cotizaciones marÃ­timas, desde la solicitud hasta la aprobaciÃ³n",
        icon: "ğŸ“‹"
    },
    {
        title: "Registro Operativo",
        description: "Captura y trazabilidad de informaciÃ³n operativa de embarques y logÃ­stica marÃ­tima",
        icon: "ğŸš¢"
    },
    {
        title: "Cierres Mensuales",
        description: "AutomatizaciÃ³n de procesos contables y reportes mensuales de operaciones",
        icon: "ğŸ“Š"
    },
    {
        title: "IntegraciÃ³n Softland",
        description: "SincronizaciÃ³n bidireccional con sistema contable empresarial Softland",
        icon: "ğŸ”„"
    }
]

const CHALLENGES = [
    {
        challenge: "Procesos manuales lentos y propensos a errores",
        solution: "AutomatizaciÃ³n con validaciones en tiempo real y flujos de aprobaciÃ³n digitales"
    },
    {
        challenge: "Falta de trazabilidad en operaciones marÃ­timas",
        solution: "Base de datos relacional con historial completo y auditorÃ­a de cambios"
    },
    {
        challenge: "DesconexiÃ³n entre cotizaciones y contabilidad",
        solution: "API de integraciÃ³n con Softland para sincronizaciÃ³n automÃ¡tica de datos"
    },
    {
        challenge: "Costos elevados de infraestructura cloud",
        solution: "Arquitectura serverless con Cloud Run (sin instancias mÃ­nimas) + branching de Neon"
    }
]

const TECHNICAL_DECISIONS = [
    {
        title: "Â¿Por quÃ© Neon Branching?",
        description: "Permite crear entornos de QA/Testing aislados sin costo adicional, usando la funciÃ³n de branches de base de datos. Cada branch es una copia ligera que comparte storage."
    },
    {
        title: "Â¿Por quÃ© Cloud Run sobre Vercel?",
        description: "Mayor control sobre costos (pago por uso real, sin instancias mÃ­nimas). Para entornos QA/Prod con trÃ¡fico irregular, el ahorro es significativo (~70% vs otras plataformas)."
    },
    {
        title: "Â¿Por quÃ© Cloudflare R2?",
        description: "Almacenamiento de documentos operativos (contratos, Ã³rdenes de compra) sin costos de egress. IntegraciÃ³n simple vÃ­a SDK y URLs presigned para seguridad."
    },
    {
        title: "Â¿Por quÃ© MS Entra ID?",
        description: "Requisito del cliente para SSO empresarial. IntegraciÃ³n con ecosistema Microsoft 365 que ya usaban. GestiÃ³n centralizada de usuarios y roles."
    }
]
---

<Layout 
    title="Case Study: Koralis - Sistema MarÃ­timo-LogÃ­stico | Marco Molina"
    description="Arquitectura y desarrollo completo de plataforma para gestiÃ³n de cotizaciones, operaciones marÃ­timas y cierres contables. Stack: NestJS, Next.js, Neon, Cloud Run, Cloudflare R2."
>
    <main class="px-4">
        <!-- Hero Section -->
        <SectionContainer class="py-16 max-w-[1000px]">
            <a href="/" class="inline-flex items-center gap-2 text-cyan-400 hover:text-cyan-300 transition-colors mb-8">
                <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
                Volver al portafolio
            </a>

            <div class="mb-8">
                <span class="text-sm bg-yellow-400/20 text-yellow-400 px-3 py-1 rounded-full font-medium">
                    Case Study
                </span>
            </div>

            <h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 via-yellow-400 to-red-400 mb-6">
                Koralis & Remoras
            </h1>
            
            <p class="text-2xl text-white/80 mb-4">
                Sistema integral de gestiÃ³n marÃ­timo-logÃ­stica
            </p>

            <p class="text-lg text-white/60 leading-relaxed">
                Plataforma web para optimizaciÃ³n de procesos de cotizaciÃ³n, registro operativo, 
                cierres contables e integraciÃ³n con sistemas empresariales del sector marÃ­timo.
            </p>

            <div class="flex flex-wrap gap-3 mt-8">
                {TECH_STACK.map(tech => (
                    <span class="flex items-center gap-2 rounded-full border border-white/20 bg-white/5 px-4 py-2 backdrop-blur-sm hover:scale-105 transition-transform">
                        <tech.icon class="size-5" />
                        <span class="text-sm font-medium">{tech.name}</span>
                    </span>
                ))}
            </div>
        </SectionContainer>

        <!-- Contexto del Proyecto -->
        <SectionContainer class="py-16 max-w-[1000px]">
            <h2 class="text-3xl font-bold mb-8 flex items-center gap-3">
                <span class="text-4xl">ğŸ¯</span>
                Contexto del Proyecto
            </h2>

            <div class="rounded-xl border border-white/10 bg-white/5 p-8 backdrop-blur-sm">
                <p class="text-lg text-white/80 leading-relaxed mb-6">
                    <strong class="text-yellow-400">Koralis</strong> es un sistema de gestiÃ³n empresarial desarrollado 
                    para el sector marÃ­timo-logÃ­stico, enfocado en digitalizar y optimizar procesos que tradicionalmente 
                    se realizaban de forma manual o con herramientas fragmentadas (Excel, emails, documentos fÃ­sicos).
                </p>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="rounded-lg border border-cyan-500/30 bg-cyan-500/5 p-6">
                        <h3 class="text-xl font-bold text-cyan-400 mb-3">Usuario Principal</h3>
                        <p class="text-white/70 text-sm leading-relaxed">
                            Empresas de logÃ­stica marÃ­tima que gestionan cotizaciones de servicios, 
                            operaciones de embarque, documentaciÃ³n de carga y contabilidad de proyectos.
                        </p>
                    </div>

                    <div class="rounded-lg border border-yellow-500/30 bg-yellow-500/5 p-6">
                        <h3 class="text-xl font-bold text-yellow-400 mb-3">Estado Actual</h3>
                        <p class="text-white/70 text-sm leading-relaxed">
                            <span class="bg-orange-500/20 text-orange-400 px-2 py-1 rounded text-xs font-medium">
                                En ConstrucciÃ³n
                            </span><br/>
                            Sistema en desarrollo activo, con mÃ³dulos core implementados y en fase de testing interno.
                        </p>
                    </div>
                </div>
            </div>
        </SectionContainer>

        <!-- Funcionalidades Principales -->
        <SectionContainer class="py-16 max-w-[1000px]">
            <h2 class="text-3xl font-bold mb-8 flex items-center gap-3">
                <span class="text-4xl">âš™ï¸</span>
                Funcionalidades Principales
            </h2>

            <div class="grid md:grid-cols-2 gap-6">
                {FEATURES.map(feature => (
                    <div class="group rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm hover:border-white/30 hover:bg-white/10 transition-all">
                        <div class="text-4xl mb-4 group-hover:scale-110 transition-transform">
                            {feature.icon}
                        </div>
                        <h3 class="text-xl font-bold text-yellow-400 mb-3">
                            {feature.title}
                        </h3>
                        <p class="text-white/70 text-sm leading-relaxed">
                            {feature.description}
                        </p>
                    </div>
                ))}
            </div>
        </SectionContainer>

        <!-- Problemas y Soluciones -->
        <SectionContainer class="py-16 max-w-[1000px]">
            <h2 class="text-3xl font-bold mb-8 flex items-center gap-3">
                <span class="text-4xl">ğŸ”§</span>
                DesafÃ­os TÃ©cnicos & Soluciones
            </h2>

            <div class="space-y-6">
                {CHALLENGES.map((item, index) => (
                    <div class="rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm hover:border-cyan-500/30 hover:bg-cyan-500/5 transition-all">
                        <div class="flex items-start gap-4">
                            <div class="text-2xl font-bold text-cyan-400 mt-1">
                                {index + 1}
                            </div>
                            <div class="flex-1">
                                <div class="mb-4">
                                    <span class="text-xs text-red-400 font-medium uppercase tracking-wide">
                                        âŒ DesafÃ­o
                                    </span>
                                    <p class="text-white/80 mt-2">
                                        {item.challenge}
                                    </p>
                                </div>
                                <div>
                                    <span class="text-xs text-green-400 font-medium uppercase tracking-wide">
                                        âœ… SoluciÃ³n
                                    </span>
                                    <p class="text-white/70 mt-2 text-sm">
                                        {item.solution}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        </SectionContainer>

        <!-- Decisiones TÃ©cnicas -->
        <SectionContainer class="py-16 max-w-[1000px]">
            <h2 class="text-3xl font-bold mb-8 flex items-center gap-3">
                <span class="text-4xl">ğŸ’¡</span>
                Decisiones de IngenierÃ­a
            </h2>

            <div class="space-y-6">
                {TECHNICAL_DECISIONS.map(decision => (
                    <div class="rounded-xl border border-yellow-500/30 bg-gradient-to-br from-yellow-500/5 to-orange-500/5 p-6 backdrop-blur-sm">
                        <h3 class="text-xl font-bold text-yellow-400 mb-3">
                            {decision.title}
                        </h3>
                        <p class="text-white/70 leading-relaxed">
                            {decision.description}
                        </p>
                    </div>
                ))}
            </div>
        </SectionContainer>

        <!-- Arquitectura del Sistema -->
        <SectionContainer class="py-16 max-w-[1000px]">
            <h2 class="text-3xl font-bold mb-8 flex items-center gap-3">
                <span class="text-4xl">ğŸ—ï¸</span>
                Arquitectura del Sistema
            </h2>

            <div class="rounded-xl border border-cyan-500/30 bg-gradient-to-br from-cyan-500/5 to-blue-500/5 p-8 backdrop-blur-sm">
                <pre class="text-sm text-white/80 font-mono leading-relaxed overflow-x-auto">
{`â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          FRONTEND (Next.js + React)             â”‚
â”‚   Â· TanStack Query (data fetching)              â”‚
â”‚   Â· Zustand (state management)                  â”‚
â”‚   Â· TailwindCSS (UI)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         API Gateway / Load Balancer             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        BACKEND (NestJS en Cloud Run)            â”‚
â”‚   Â· Modules: Auth, Quotes, Operations, Reports  â”‚
â”‚   Â· Prisma ORM                                  â”‚
â”‚   Â· MS Entra ID (SSO)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚
        â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL      â”‚   â”‚  Cloudflare R2       â”‚
â”‚  (Neon)          â”‚   â”‚  (File Storage)      â”‚
â”‚                  â”‚   â”‚                      â”‚
â”‚  Â· Branching:    â”‚   â”‚  Â· Contratos         â”‚
â”‚    - Prod        â”‚   â”‚  Â· Ã“rdenes Compra    â”‚
â”‚    - QA          â”‚   â”‚  Â· Docs Operativos   â”‚
â”‚    - Test        â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚    - Demo        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          IntegraciÃ³n Softland (ERP)              â”‚
â”‚          API REST bidireccional                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜`}
                </pre>
            </div>
        </SectionContainer>

        <!-- Lecciones Aprendidas -->
        <SectionContainer class="py-16 max-w-[1000px] mb-40">
            <h2 class="text-3xl font-bold mb-8 flex items-center gap-3">
                <span class="text-4xl">ğŸ“š</span>
                Lecciones TÃ©cnicas
            </h2>

            <div class="space-y-4">
                <div class="rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm">
                    <h3 class="text-lg font-bold text-cyan-400 mb-2">
                        Neon Branching cambiÃ³ la forma de gestionar entornos
                    </h3>
                    <p class="text-white/70 text-sm leading-relaxed">
                        Poder crear una branch de base de datos en segundos para QA/testing sin costo adicional 
                        eliminÃ³ la necesidad de mantener mÃºltiples bases de datos. Cada desarrollador puede tener 
                        su propia branch para probar migraciones sin afectar a otros.
                    </p>
                </div>

                <div class="rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm">
                    <h3 class="text-lg font-bold text-cyan-400 mb-2">
                        Cloud Run es ideal para trÃ¡fico irregular
                    </h3>
                    <p class="text-white/70 text-sm leading-relaxed">
                        Para un sistema B2B con 20-30 usuarios activos en horario laboral, pagar solo por requests 
                        reales (sin instancias mÃ­nimas) redujo costos dramÃ¡ticamente vs. mantener servidores 24/7. 
                        El auto-scaling es automÃ¡tico y la latencia de cold start (~1s) es aceptable para este caso de uso.
                    </p>
                </div>

                <div class="rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm">
                    <h3 class="text-lg font-bold text-cyan-400 mb-2">
                        La integraciÃ³n con sistemas legacy es el 70% del trabajo
                    </h3>
                    <p class="text-white/70 text-sm leading-relaxed">
                        Conectar con Softland (sistema contable tradicional) requiriÃ³ mÃ¡s tiempo que desarrollar 
                        el sistema completo. DocumentaciÃ³n inexistente, APIs inestables y formatos de datos legacy. 
                        AprendÃ­ la importancia de considerar integraciones desde la arquitectura inicial.
                    </p>
                </div>

                <div class="rounded-xl border border-white/10 bg-white/5 p-6 backdrop-blur-sm">
                    <h3 class="text-lg font-bold text-cyan-400 mb-2">
                        MS Entra ID es complejo pero vale la pena para empresas
                    </h3>
                    <p class="text-white/70 text-sm leading-relaxed">
                        La curva de aprendizaje de Microsoft Identity Platform es empinada, pero para clientes 
                        corporativos que ya usan Microsoft 365, el SSO es un must-have. Usuarios y roles 
                        centralizados significan menos gestiÃ³n manual.
                    </p>
                </div>
            </div>
        </SectionContainer>
    </main>
</Layout>
